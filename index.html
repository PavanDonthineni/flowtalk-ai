<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ff5c35">
<meta name="description" content="FlowTalk AI - India's First AI Presentation Studio. Present, transcribe and flow in 12 languages including Hindi, Tamil, Telugu, Bengali and more.">
<title>FlowTalk AI â€” India's First AI Presentation Studio</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23ff5c35'/><text x='50' y='70' font-size='60' font-weight='800' font-family='system-ui' text-anchor='middle' fill='white'>FT</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--ink:#0a0a0f;--paper:#f7f6f2;--cream:#ede9df;--accent:#ff5c35;--accent2:#00c9a7;--accent3:#5b6af5;--muted:#8a8880;--border:rgba(10,10,15,0.1)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;font-family:'DM Sans',sans-serif;background:var(--paper);color:var(--ink)}
.app{display:flex;flex-direction:column;height:100vh;height:100dvh}
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 16px;
  background:var(--ink);
  flex-shrink:0;
}

.logo{
  display:flex;
  align-items:flex-start;
  gap:8px;
  text-decoration:none;
}
.logo-mark{
  width:32px;
  height:32px;
  background:#ff5c35;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:.85rem;
  color:white;
}
.logo-text{font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem;color:white}
.logo-text span{color:var(--accent)}
.tagline{
  font-size:0.75rem;
  color:rgba(255,255,255,0.6);
  margin-top:2px;
}

.topbar-right{display:flex;align-items:center;gap:8px}
.badge{background:var(--accent);color:white;font-size:.65rem;font-weight:700;padding:3px 8px;border-radius:20px;text-transform:uppercase}
.rec-badge{background:rgba(255,92,53,.2);color:var(--accent);font-size:.72rem;font-weight:700;padding:3px 10px;border-radius:20px;display:none;align-items:center;gap:5px}
.rec-badge.on{display:flex}
.rec-dot-sm{width:7px;height:7px;background:var(--accent);border-radius:50%;animation:blink 1s infinite}
.pages{flex:1;overflow:hidden;position:relative}
.page{position:absolute;inset:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:16px 16px 24px;display:none}
.page.active{display:block}
.page::-webkit-scrollbar{display:none}
.bottom-nav{display:flex;background:white;border-top:1.5px solid var(--border);flex-shrink:0;padding-bottom:env(safe-area-inset-bottom,0)}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:10px 4px 8px;border:none;background:none;cursor:pointer}
.nav-btn .ni{font-size:1.35rem;transition:transform .2s}
.nav-btn .nl{font-size:.68rem;font-weight:600;color:var(--muted)}
.nav-btn.active .nl{color:var(--accent)}
.nav-btn.active .ni{transform:scale(1.15)}
.nav-btn:active .ni{transform:scale(.9)}
.card{background:white;border-radius:14px;padding:16px;margin-bottom:12px;border:1px solid var(--border)}
.card-title{font-family:'Syne',sans-serif;font-weight:700;font-size:.75rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin-bottom:12px}
.section-title{font-family:'Syne',sans-serif;font-weight:800;font-size:1.5rem;letter-spacing:-.5px;margin-bottom:4px}
.section-sub{font-size:.88rem;color:var(--muted);margin-bottom:16px}
.btn{width:100%;padding:15px 20px;border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:600;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:10px;min-height:52px}
.btn:last-child{margin-bottom:0}
.btn:active:not(:disabled){transform:scale(.97)}
.btn:disabled{opacity:.4;pointer-events:none}
.btn-primary{background:var(--ink);color:white}
.btn-accent{background:var(--accent);color:white}
.btn-teal{background:var(--accent2);color:white}
.btn-blue{background:var(--accent3);color:white}
.btn-ghost{background:var(--cream);color:var(--ink);border:1px solid var(--border)}
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.btn-row .btn{margin-bottom:0}
input[type=range]{-webkit-appearance:none;width:100%;height:5px;background:var(--cream);border-radius:3px;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--ink);cursor:pointer;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.slider-row{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.slider-label{font-size:.88rem;font-weight:600;min-width:80px}
.slider-val{font-size:.88rem;font-weight:700;color:var(--accent);min-width:36px;text-align:right}
select,input[type=text],input[type=number]{width:100%;padding:13px 14px;border:1.5px solid var(--border);border-radius:10px;font-family:'DM Sans',sans-serif;font-size:1rem;background:white;color:var(--ink);outline:none;-webkit-appearance:none;margin-bottom:10px}
select:focus,input:focus{border-color:var(--accent3)}
.select-wrap{position:relative;margin-bottom:10px}
.select-wrap select{margin-bottom:0}
.select-wrap::after{content:'â–¾';position:absolute;right:14px;top:50%;transform:translateY(-50%);pointer-events:none;color:var(--muted)}
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:11px 0;border-bottom:1px solid var(--border)}
.toggle-row:last-child{border-bottom:none;padding-bottom:0}
.toggle-label{font-size:.95rem;font-weight:500}
.tog{position:relative;width:46px;height:26px;flex-shrink:0}
.tog input{display:none}
.tog-track{position:absolute;inset:0;background:#ddd;border-radius:13px;cursor:pointer;transition:background .25s}
.tog-track::before{content:'';position:absolute;width:20px;height:20px;background:white;border-radius:50%;top:3px;left:3px;transition:transform .25s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.tog input:checked+.tog-track{background:var(--accent2)}
.tog input:checked+.tog-track::before{transform:translateX(20px)}
.lang-row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px}
.lang-pill{padding:10px 4px;border:1.5px solid var(--border);border-radius:10px;background:white;font-family:'DM Sans',sans-serif;font-size:.8rem;font-weight:600;cursor:pointer;text-align:center;transition:all .2s}
.lang-pill.active{border-color:var(--ink);background:var(--ink);color:white}
.transcript-box{background:var(--cream);border-radius:12px;padding:14px;max-height:160px;overflow-y:auto;font-size:.9rem;line-height:1.6;color:#555;-webkit-overflow-scrolling:touch}
.transcript-box::-webkit-scrollbar{display:none}
.spk{display:inline-block;padding:2px 8px;border-radius:5px;font-size:.72rem;font-weight:700;margin-right:5px}
.spk1{background:#e7f5ff;color:var(--accent3)}
.spk2{background:#fff3e0;color:#e67700}
.kw-wrap{display:flex;flex-wrap:wrap;gap:8px;padding:4px 0;min-height:30px}
.kw-tag{padding:7px 14px;background:var(--cream);border-radius:20px;font-size:.85rem;font-weight:500;color:var(--ink);border:1px solid var(--border)}
.action-card{background:var(--cream);border-left:3px solid var(--accent3);border-radius:10px;padding:12px 14px;margin-bottom:8px;font-size:.9rem;line-height:1.5}
.action-card strong{display:block;font-size:.75rem;color:var(--accent3);font-weight:700;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.summary-box{background:linear-gradient(135deg,#eef2ff,#f0fdf9);border-radius:12px;padding:14px;font-size:.92rem;line-height:1.65;color:#3d4451;margin-bottom:12px;display:none}
.saved-list{border:1.5px solid var(--border);border-radius:12px;overflow:hidden}
.saved-item{display:flex;align-items:center;justify-content:space-between;padding:14px;cursor:pointer;border-bottom:1px solid var(--border);transition:background .15s;gap:10px}
.saved-item:last-child{border-bottom:none}
.saved-item:active{background:var(--cream)}
.saved-item-info strong{display:block;font-size:.92rem;font-weight:600}
.saved-item-info span{font-size:.8rem;color:var(--muted);margin-top:2px}
.del-btn{width:36px;height:36px;border-radius:10px;border:1.5px solid var(--border);background:white;color:var(--accent);font-size:.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.del-btn:active{transform:scale(.9)}
.empty-state{text-align:center;padding:32px 24px;color:var(--muted);font-size:.92rem}
.ei{font-size:2.5rem;margin-bottom:12px;display:block;opacity:0.5}
.vbar-wrap{height:6px;background:var(--cream);border-radius:3px;overflow:hidden;margin-top:14px;border:1px solid var(--border)}
.vbar{height:100%;width:0%;background:var(--accent2);transition:width .1s;border-radius:3px}
.mtimer{font-family:'Syne',sans-serif;font-size:4rem;font-weight:800;text-align:center;padding:24px;background:white;border-radius:18px;margin:14px 0;letter-spacing:4px;border:2px solid var(--border)}
.toolbar{display:flex;gap:8px;margin-bottom:12px;overflow-x:auto;padding-bottom:4px}
.toolbar::-webkit-scrollbar{display:none}
.tchip{flex-shrink:0;padding:10px 16px;border:1.5px solid var(--border);border-radius:20px;background:white;font-size:.82rem;font-weight:500;cursor:pointer;white-space:nowrap;transition:all .2s}
.tchip:active{background:var(--cream)}
.script-editor{width:100%;min-height:200px;max-height:280px;padding:16px;border:1.5px solid var(--border);border-radius:14px;font-family:'DM Sans',sans-serif;font-size:1.05rem;line-height:1.8;color:var(--ink);background:white;resize:none;outline:none}
.script-editor:focus{border-color:var(--accent3)}
.word-count{text-align:right;font-size:.85rem;color:var(--muted);margin-top:8px;font-weight:500}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.stat-box{background:var(--cream);border-radius:14px;padding:18px;text-align:center;border:1px solid var(--border)}
.stat-num{font-family:'Syne',sans-serif;font-size:2rem;font-weight:800;margin-bottom:4px}
.stat-lbl{font-size:.8rem;color:var(--muted);margin-top:4px;font-weight:500}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--ink);color:white;padding:14px 24px;border-radius:30px;font-size:.92rem;font-weight:500;opacity:0;transition:all .3s;z-index:9999;pointer-events:none;white-space:nowrap;max-width:90vw;text-align:center}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.prompter-screen{display:none;position:fixed;inset:0;background:#000;z-index:999;flex-direction:column}
.prompter-screen.on{display:flex}
.p-vbar{height:4px;background:rgba(255,255,255,.1);flex-shrink:0}
.p-vfill{height:100%;width:0%;background:var(--accent);transition:width .1s}
.p-wrap{flex:1;overflow:hidden;position:relative}
.p-text{padding:48px 32px 240px;text-align:center;font-family:'Syne',sans-serif;font-size:2rem;font-weight:600;line-height:1.85;color:white;will-change:transform}
.p-hud{display:flex;align-items:center;justify-content:center;gap:12px;padding:18px 24px;background:rgba(0,0,0,0.6);flex-shrink:0;padding-bottom:calc(18px + env(safe-area-inset-bottom,0))}
.hud-btn{width:56px;height:56px;border-radius:50%;border:2px solid rgba(255,255,255,.25);background:rgba(255,255,255,.15);color:white;font-size:1.3rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.hud-btn:active{transform:scale(.9);background:rgba(255,255,255,.3)}
.hud-exit{background:rgba(255,92,53,.3);border-color:rgba(255,92,53,.6)}
.hud-spd{font-family:'Syne',sans-serif;color:rgba(255,255,255,.7);font-size:.9rem;font-weight:700;min-width:70px;text-align:center}
.countdown-overlay{position:fixed;inset:0;background:black;z-index:1000;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:10rem;font-weight:800;color:white}
.quick-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.quick-card{background:white;border:1.5px solid var(--border);border-radius:14px;padding:20px 16px;cursor:pointer;text-align:center;transition:all .2s}
.quick-card:active{transform:scale(.97);background:var(--cream)}
.qi{font-size:2rem;margin-bottom:8px;display:block}
.qn{font-size:.85rem;font-weight:700;color:var(--ink);margin-bottom:2px}
.qd{font-size:.75rem;color:var(--muted);margin-top:4px}
.ios-tip{background:#fff9e6;border-left:3px solid #ffc107;border-radius:10px;padding:12px 14px;margin-bottom:12px;font-size:.88rem;line-height:1.6;color:#666}
.ios-tip strong{color:#e67700}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
</style>
</head>
<body>
<div class="app">
<div class="topbar">
<a href="#" class="logo">
<div class="logo-mark">FT</div>
<div>
  <div class="logo-text">FlowTalk <span>AI</span></div>
  <div class="tagline">Speak. Script. Present.</div>
</div>
</a>
<div class="topbar-right">
<span class="badge">BETA</span>
<span class="rec-badge" id="recBadge"><span class="rec-dot-sm"></span>REC</span>
</div>
</div>
<div class="pages">
<!-- PROMPTER TAB -->
<div class="page active" data-tab="prompter">
<div class="section-title">Prompter</div>
<div class="section-sub">Create and present your script with AI assistance</div>
<div class="card">
<div class="card-title">ğŸ“ Script Editor</div>
<textarea id="scriptText" class="script-editor" placeholder="Type or paste your script here..."></textarea>
<div class="word-count" id="wordCount">0 words</div>
</div>
<div class="card">
<div class="card-title">âš™ï¸ Settings</div>
<div class="slider-row">
<span class="slider-label">Speed</span>
<input type="range" id="sldSpeed" min="1" max="10" value="5" step="1">
<span class="slider-val" id="valSpeed">5</span>
</div>
<div class="slider-row">
<span class="slider-label">Text Size</span>
<input type="range" id="sldSize" min="32" max="72" value="48" step="4">
<span class="slider-val" id="valSize">48px</span>
</div>
<div class="select-wrap">
<select id="selTextColor">
<option value="white">Text: White</option>
<option value="#00ff88">Text: Mint</option>
<option value="#ffd700">Text: Gold</option>
<option value="#ff6b9d">Text: Pink</option>
</select>
</div>
<div class="select-wrap">
<select id="selBgColor">
<option value="black">BG: Black</option>
<option value="#1a1a2e">BG: Navy</option>
<option value="#2d4a3e">BG: Forest</option>
</select>
</div>
<div class="toggle-row">
<span class="toggle-label">ğŸ¤ Voice Auto-Scroll</span>
<label class="tog"><input type="checkbox" id="togVoice"><span class="tog-track"></span></label>
</div>
</div>
<button class="btn btn-accent" id="btnStartPrompter">â–¶ Start Presenting</button>
<div class="card">
<div class="card-title">ğŸ’¾ Saved Scripts</div>
<input type="text" id="scriptName" placeholder="Script name...">
<button class="btn btn-ghost" onclick="saveScript()">ğŸ’¾ Save Script</button>
<div id="savedList" class="saved-list" style="display:none"></div>
<div id="emptySaved" class="empty-state"><span class="ei">ğŸ“„</span>No saved scripts yet</div>
</div>
</div>
<!-- RECORD TAB -->
<div class="page" data-tab="record">
<div class="section-title">Record</div>
<div class="section-sub">Speak to build your script</div>
<div class="card">
<div class="card-title">ğŸŒ Language</div>
<div class="lang-row">
<button class="lang-pill active" data-lang="en-US">ğŸ‡ºğŸ‡¸ EN</button>
<button class="lang-pill" data-lang="hi-IN">ğŸ‡®ğŸ‡³ HI</button>
<button class="lang-pill" data-lang="ta-IN">ğŸ‡®ğŸ‡³ TA</button>
<button class="lang-pill" data-lang="te-IN">ğŸ‡®ğŸ‡³ TE</button>
<button class="lang-pill" data-lang="bn-IN">ğŸ‡®ğŸ‡³ BN</button>
<button class="lang-pill" data-lang="mr-IN">ğŸ‡®ğŸ‡³ MR</button>
<button class="lang-pill" data-lang="gu-IN">ğŸ‡®ğŸ‡³ GU</button>
<button class="lang-pill" data-lang="kn-IN">ğŸ‡®ğŸ‡³ KN</button>
<button class="lang-pill" data-lang="ml-IN">ğŸ‡®ğŸ‡³ ML</button>
<button class="lang-pill" data-lang="es-ES">ğŸ‡ªğŸ‡¸ ES</button>
<button class="lang-pill" data-lang="fr-FR">ğŸ‡«ğŸ‡· FR</button>
<button class="lang-pill" data-lang="de-DE">ğŸ‡©ğŸ‡ª DE</button>
</div>
<div style="background:var(--cream);border-radius:8px;padding:8px 10px;font-size:.75rem;color:#666;line-height:1.5;margin-top:8px">
<strong>Languages:</strong> EN=English, HI=Hindi, TA=Tamil, TE=Telugu, BN=Bengali, MR=Marathi, GU=Gujarati, KN=Kannada, ML=Malayalam
</div>
<div class="toggle-row" style="margin-top:12px">
<span class="toggle-label">Speaker ID</span>
<label class="tog"><input type="checkbox" id="togSpeaker"><span class="tog-track"></span></label>
</div>
</div>
<div class="card" id="iosTipCard" style="display:none">
<div class="ios-tip">
ğŸ“± <strong>iOS tip:</strong> Use Safari browser (not Chrome). Make sure the app is open via <strong>https://</strong> link. Go to Settings â†’ Safari â†’ Microphone â†’ Allow.
</div>
</div>
<div class="card">
<div class="card-title">ğŸ™ Speech-to-Text</div>
<button class="btn btn-accent" id="btnSTTStart">ğŸ”´ Start Recording</button>
<button class="btn btn-ghost" id="btnSTTStop" disabled>â¹ Stop Recording</button>
<div class="card-title" style="margin-top:16px">ğŸ“ Live Transcript</div>
<div class="transcript-box" id="liveTranscript">
<span style="color:#bbb">Your words appear here in real-time...</span>
</div>
<div id="voiceBarWrap" class="vbar-wrap" style="display:none">
<div class="vbar" id="voiceBar"></div>
</div>
</div>
<div class="card">
<div class="card-title">ğŸ”Š Text-to-Speech</div>
<button class="btn btn-blue" id="btnTTSStart">â–¶ Read Script Aloud</button>
<button class="btn btn-ghost" id="btnTTSStop" style="display:none">â¸ Stop Reading</button>
</div>
</div>
<!-- AI TOOLS TAB -->
<div class="page" data-tab="ai">
<div class="section-title">AI Tools</div>
<div class="section-sub">Enhance your content with AI</div>
<div class="quick-grid">
<div class="quick-card" onclick="genSummary()">
<span class="qi">ğŸ“„</span>
<div class="qn">Summarize</div>
<div class="qd">Get key points</div>
</div>
<div class="quick-card" onclick="genKeywords()">
<span class="qi">ğŸ”‘</span>
<div class="qn">Keywords</div>
<div class="qd">Extract topics</div>
</div>
<div class="quick-card" onclick="genActions()">
<span class="qi">ğŸ“‹</span>
<div class="qn">Action Items</div>
<div class="qd">Find tasks</div>
</div>
<div class="quick-card" onclick="genStats()">
<span class="qi">ğŸ“Š</span>
<div class="qn">Word Stats</div>
<div class="qd">Analyze text</div>
</div>
</div>
<div class="summary-box" id="summaryBox"></div>
<div class="card" id="keywordsCard" style="display:none">
<div class="card-title">ğŸ”‘ Keywords</div>
<div class="kw-wrap" id="kwWrap"></div>
</div>
<div class="card" id="actionsCard" style="display:none">
<div class="card-title">ğŸ“‹ Action Items</div>
<div id="actionsWrap"></div>
</div>
<div class="card" id="statsCard" style="display:none">
<div class="card-title">ğŸ“Š Word Statistics</div>
<div class="stats-grid" id="statsGrid"></div>
</div>
<div class="card">
<div class="card-title">ğŸ›  Quick Tools</div>
<div class="toolbar">
<button class="tchip" onclick="insertTxt('â€¢ ')">â€¢ Bullet</button>
<button class="tchip" onclick="insertTxt('\n\n')">Â¶ Para</button>
<button class="tchip" onclick="capsAll()">CAPS</button>
<button class="tchip" onclick="clearEditor()">âœ• Clear</button>
</div>
</div>
<div class="card">
<div class="card-title">ğŸ“¥ Export</div>
<div class="btn-row">
<button class="btn btn-ghost" onclick="copyAll()">ğŸ“‹ Copy All</button>
<button class="btn btn-ghost" onclick="exportTxt()">ğŸ“¥ Save .txt</button>
</div>
</div>
</div>
<!-- MEETING TAB -->
<div class="page" data-tab="meeting">
<div class="section-title">Meeting</div>
<div class="section-sub">Record and analyze meetings</div>
<div class="card">
<div class="card-title">ğŸš€ New Meeting</div>
<input type="text" id="meetingTitle" placeholder="Meeting title...">
<input type="text" id="meetingParticipants" placeholder="Participants (comma separated)...">
<div class="mtimer" id="meetingTimer">00:00</div>
<button class="btn btn-accent" id="btnStartMeeting">ğŸš€ Start Meeting Recording</button>
<button class="btn btn-ghost" id="btnEndMeeting" disabled>â¹ End Meeting & Save</button>
</div>
<div class="card">
<div class="card-title">ğŸ“Š Meeting Report</div>
<button class="btn btn-blue" onclick="exportMeeting()">ğŸ“Š Export Meeting Report</button>
</div>
<div class="card">
<div class="card-title">ğŸ“… Past Meetings</div>
<div id="meetingsList" class="saved-list" style="display:none"></div>
<div id="emptyMeetings" class="empty-state"><span class="ei">ğŸ“…</span>No meetings yet</div>
</div>
</div>
</div>
<div class="bottom-nav">
<button class="nav-btn active" data-nav="prompter"><span class="ni">ğŸ¬</span><span class="nl">Prompter</span></button>
<button class="nav-btn" data-nav="record"><span class="ni">ğŸ™</span><span class="nl">Record</span></button>
<button class="nav-btn" data-nav="ai"><span class="ni">âœ¨</span><span class="nl">AI Tools</span></button>
<button class="nav-btn" data-nav="meeting"><span class="ni">ğŸ“Š</span><span class="nl">Meeting</span></button>
</div>
</div>
<div class="prompter-screen" id="prompterScreen">
<div class="p-vbar"><div class="p-vfill" id="pVbar"></div></div>
<div class="p-wrap">
<div class="p-text" id="pText"></div>
</div>
<div class="p-hud">
<button class="hud-btn" id="hudSlow">ğŸ¢</button>
<button class="hud-btn" id="hudPause">â¸</button>
<div class="hud-spd" id="hudSpd">Speed 5</div>
<button class="hud-btn" id="hudFast">ğŸ‡</button>
<button class="hud-btn hud-exit" id="hudExit">âœ•</button>
</div>
</div>
<div class="toast" id="toast"></div>
<script>
const el=id=>document.getElementById(id);
const S={lang:'en-US',speed:5,txtColor:'white',bgColor:'black',voiceOn:false,speakerOn:false,speaker:1,scrolling:false,paused:false,scrollPos:0,raf:null,transcript:'',recog:null,recogActive:false,ttsUtt:null,micStream:null,audioCtx:null,analyser:null,mic:null,meetingStart:null,meetingTimer:null,recStart:null,recTimer:null};


// DETECT iOS
const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||(navigator.platform==='MacIntel'&&navigator.maxTouchPoints>1);
if(isIOS){el('iosTipCard').style.display='block';}

// TOAST
function toast(msg,dur=2000){const t=el('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),dur);}

// BOTTOM NAV
document.querySelectorAll('.nav-btn').forEach(btn=>{
btn.addEventListener('click',()=>{
document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
const tab=btn.dataset.nav;
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.querySelector(`.page[data-tab="${tab}"]`).classList.add('active');
});
});

// LANG PILLS - FIXED: Stops/restarts recording when language changes
document.querySelectorAll('.lang-pill').forEach(b=>{
b.addEventListener('click',()=>{
const wasRecording=S.recogActive;
const newLang=b.dataset.lang;
if(wasRecording){stopSTT();}
document.querySelectorAll('.lang-pill').forEach(x=>x.classList.remove('active'));
b.classList.add('active');
S.lang=newLang;
toast('Language: '+b.textContent.trim());
if(wasRecording){
setTimeout(()=>{
startSTT();
toast('Recording restarted in '+b.textContent.trim());
},500);
}
});
});

// WORD COUNT
el('scriptText').addEventListener('input',updateWC);
function updateWC(){const w=el('scriptText').value.trim().split(/\s+/).filter(Boolean).length;el('wordCount').textContent=w+' word'+(w!==1?'s':'');}

// SLIDERS
el('sldSpeed').addEventListener('input',e=>{S.speed=+e.target.value;el('valSpeed').textContent=S.speed;el('hudSpd').textContent='Speed '+S.speed;});
el('sldSize').addEventListener('input',e=>{el('valSize').textContent=e.target.value+'px';el('pText').style.fontSize=e.target.value+'px';});

// TOOLBAR
function insertTxt(txt){const ta=el('scriptText'),s=ta.selectionStart;ta.value=ta.value.slice(0,s)+txt+ta.value.slice(ta.selectionEnd);ta.selectionStart=ta.selectionEnd=s+txt.length;ta.focus();}
function capsAll(){el('scriptText').value=el('scriptText').value.toUpperCase();}
function clearEditor(){if(!el('scriptText').value.trim())return;if(confirm('Clear the script?')){el('scriptText').value='';S.transcript='';updateWC();el('liveTranscript').innerHTML='<span style="color:#bbb">Your words appear here in real-time...</span>';toast('Editor cleared');}}

// VOICE TOGGLE
el('togVoice').addEventListener('change',async e=>{
if(e.target.checked){
try{await startVoiceMonitor();S.voiceOn=true;toast('ğŸ¤ Voice control ON');}
catch(err){e.target.checked=false;toast('âš  Mic access denied');}
}else{stopVoiceMonitor();S.voiceOn=false;toast('Voice control OFF');}
});
el('togSpeaker').addEventListener('change',e=>{S.speakerOn=e.target.checked;});

// VOICE MONITOR â€” skip on iOS
async function startVoiceMonitor(){
if(isIOS)return;
try{
S.micStream=await navigator.mediaDevices.getUserMedia({audio:true,video:false});
S.audioCtx=new(window.AudioContext||window.webkitAudioContext)();
await S.audioCtx.resume();
S.analyser=S.audioCtx.createAnalyser();S.analyser.fftSize=512;
S.mic=S.audioCtx.createMediaStreamSource(S.micStream);
S.mic.connect(S.analyser);watchVol();
el('voiceBarWrap').style.display='block';
}catch(e){console.warn('Voice monitor failed:',e);}
}
function watchVol(){
if(!S.analyser)return;
const arr=new Uint8Array(S.analyser.frequencyBinCount);
S.analyser.getByteFrequencyData(arr);
const vol=Math.min(100,(arr.reduce((a,b)=>a+b,0)/arr.length/255)*250);
el('voiceBar').style.width=vol+'%';
if(S.scrolling&&!S.paused){S.paused=vol<35;}
requestAnimationFrame(watchVol);
}
function stopVoiceMonitor(){
if(S.mic){S.mic.disconnect();S.mic=null;}
if(S.analyser){S.analyser=null;}
if(S.audioCtx){S.audioCtx.close();S.audioCtx=null;}
if(S.micStream){S.micStream.getTracks().forEach(t=>t.stop());S.micStream=null;}
el('voiceBarWrap').style.display='none';
}

// PROMPTER
el('btnStartPrompter').addEventListener('click',()=>{
const txt=el('scriptText').value.trim();
if(!txt){toast('âš  Add some text first!');return;}
el('pText').textContent=txt;
el('pText').style.fontSize=el('sldSize').value+'px';
el('pText').style.color=el('selTextColor').value;
el('prompterScreen').style.background=el('selBgColor').value;
S.scrollPos=0;S.paused=false;
showCountdown();
});
function showCountdown(){
const cd=document.createElement('div');cd.className='countdown-overlay';cd.textContent='3';
document.body.appendChild(cd);
let n=3;
const iv=setInterval(()=>{
n--;
if(n===0){clearInterval(iv);cd.remove();startPrompter();}
else{cd.textContent=n;}
},1000);
}
function startPrompter(){
el('prompterScreen').classList.add('on');
S.scrolling=true;scrollLoop();
toast('Swipe down or press ESC to exit',3000);
}
function scrollLoop(){
if(!S.scrolling)return;
if(!S.paused){S.scrollPos+=S.speed*0.5;el('pText').style.transform='translateY(-'+S.scrollPos+'px)';}
S.raf=requestAnimationFrame(scrollLoop);
}
function stopPrompter(){
S.scrolling=false;S.paused=false;
if(S.raf){cancelAnimationFrame(S.raf);S.raf=null;}
el('prompterScreen').classList.remove('on');
el('hudPause').textContent='â¸';
}
el('hudPause').addEventListener('click',()=>{S.paused=!S.paused;el('hudPause').textContent=S.paused?'â–¶':'â¸';});
el('hudSlow').addEventListener('click',()=>adjSpd(-1));
el('hudFast').addEventListener('click',()=>adjSpd(1));
el('hudExit').addEventListener('click',stopPrompter);
function adjSpd(d){S.speed=Math.max(1,Math.min(10,S.speed+d));el('sldSpeed').value=S.speed;el('valSpeed').textContent=S.speed;el('hudSpd').textContent='Speed '+S.speed;}
let tsY=0;
el('prompterScreen').addEventListener('touchstart',e=>{tsY=e.touches[0].clientY;},{passive:true});
el('prompterScreen').addEventListener('touchend',e=>{if(e.changedTouches[0].clientY-tsY>80)stopPrompter();},{passive:true});
document.addEventListener('keydown',e=>{if(e.key==='Escape'&&S.scrolling)stopPrompter();});

// SPEECH TO TEXT - ENHANCED iOS SUPPORT
el('btnSTTStart').addEventListener('click',startSTT);
el('btnSTTStop').addEventListener('click',stopSTT);

function startSTT(){
const hasSR='SpeechRecognition'in window||'webkitSpeechRecognition'in window;
if(!hasSR){
if(isIOS){
toast('âš  Use Safari on iOS for recording');
el('liveTranscript').innerHTML='<div style="color:#c00;font-weight:600;padding:8px">âš ï¸ iOS requires Safari browser for Speech-to-Text.<br><br>Open this page in <strong>Safari</strong> (not Chrome) on your iPhone.</div>';
}else{toast('âš  Use Chrome for Speech-to-Text');}
return;
}
if(isIOS&&location.protocol!=='https:'&&location.hostname!=='localhost'){
el('liveTranscript').innerHTML='<div style="color:#c00;font-weight:600;padding:8px">âš ï¸ Microphone requires HTTPS.<br><br>Please open this app via a <strong>https://</strong> link (e.g. Netlify).<br><br>File:// URLs don\'t work for mic on iOS.</div>';
toast('âš  HTTPS required for mic on iOS');
return;
}
S.recogActive=true;
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
S.recog=new SR();
S.recog.continuous=!isIOS;
S.recog.interimResults=!isIOS;
S.recog.maxAlternatives=1;
S.recog.lang=S.lang;
console.log('Starting STT with language:',S.lang,'iOS:',isIOS);

S.recog.onstart=()=>{S.recStart = Date.now();

if (S.recTimer) clearInterval(S.recTimer);

S.recTimer = setInterval(()=>{
    const elapsed = Math.floor((Date.now() - S.recStart) / 1000);
    const m = Math.floor(elapsed / 60);
    const s = elapsed % 60;
    el('btnSTTStart').innerHTML =
        '<span style="display:inline-block;width:8px;height:8px;background:white;border-radius:50%;animation:blink 1s infinite;margin-right:6px"></span>' +
        (isIOS ? 'Listening... ' : 'Recording... ') +
        String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
},1000);

console.log('STT started, language:',S.lang);
el('btnSTTStart').disabled=true;el('btnSTTStop').disabled=false;
el('liveTranscript').innerHTML=isIOS
?'<span style="color:#888;font-style:italic">ğŸ™ Listening in '+S.lang+'... Speak now, tap Stop when done.</span>'
:'';
el('recBadge').classList.add('on');
if(!isIOS&&!S.analyser)startVoiceMonitor().catch(()=>{});
toast('ğŸ™ '+(isIOS?'Listening in '+S.lang.split('-')[0].toUpperCase():'Recording â€” speak now'));
};

S.recog.onresult=e=>{
console.log('STT result event, lang:',S.lang,'results:',e.results.length);
let interim='',final='';
for(let i=e.resultIndex;i<e.results.length;i++){
const t=e.results[i][0].transcript;
console.log('Result',i,'isFinal:',e.results[i].isFinal,'text:',t);
if(e.results[i].isFinal)final+=t+' ';
else interim=t;
}
if(final){
console.log('Final text:',final);
el('scriptText').value+=final;S.transcript+=final;updateWC();
const chip=S.speakerOn?'<span class="spk spk'+S.speaker+'">Spk'+S.speaker+'</span>':'';
el('liveTranscript').innerHTML+='<div style="margin-bottom:6px">'+chip+final+'</div>';
if(final.split(/[.!?]/).length>3)S.speaker=S.speaker===1?2:1;
}
if(interim&&!isIOS){
const prev=el('liveTranscript').querySelector('[data-interim]');if(prev)prev.remove();
const d=document.createElement('div');d.dataset.interim='1';
d.style.cssText='color:#aaa;font-style:italic;margin-bottom:6px';d.textContent=interim;
el('liveTranscript').appendChild(d);
}
el('liveTranscript').scrollTop=99999;
};

S.recog.onerror=e=>{
console.error('STT error:',e.error,'message:',e.message);
if(e.error==='no-speech'){
console.log('No speech detected, auto-restarting...');
if(isIOS&&S.recogActive){
setTimeout(()=>{
if(S.recogActive&&S.recog){
try{S.recog.start();}catch(err){console.error('Restart failed:',err);}
}
},300);
}
return;
}
if(e.error==='not-allowed'){
el('liveTranscript').innerHTML='<div style="color:#c00;font-weight:600;padding:8px">âš ï¸ Microphone blocked.<br><br>Tap the <strong>AA</strong> button in Safari address bar â†’ Website Settings â†’ Microphone â†’ Allow.<br><br>Or go to Settings â†’ Safari â†’ Microphone â†’ Allow.</div>';
toast('âš  Mic blocked â€” tap AA button');
stopSTT();return;
}
if(e.error==='aborted'){
console.log('Recognition aborted (likely language change)');
return;
}
toast('âš  Mic error: '+e.error);
if(e.error!=='network')stopSTT();
};

S.recog.onend=()=>{
console.log('STT ended, recogActive:',S.recogActive);
if(S.recogActive&&S.recog){
setTimeout(()=>{
if(S.recogActive&&S.recog){
try{
console.log('Auto-restarting STT...');
S.recog.start();
}catch(e){
console.error('Auto-restart failed:',e);
S.recogActive=false;stopSTT();
}
}
},isIOS?500:100);
}
};

try{
S.recog.start();
}catch(e){
console.error('STT start error:',e);
toast('âš  Could not start mic: '+e.message);
S.recog=null;S.recogActive=false;
}
}



function stopSTT(){
S.recogActive=false;

if (S.recTimer) {
   clearInterval(S.recTimer);
   S.recTimer = null;
}

if(S.recog){try{S.recog.stop();S.recog.abort();}catch(e){}S.recog=null;}
el('btnSTTStart').innerHTML='ğŸ”´ Start Recording';
el('btnSTTStart').disabled=false;el('btnSTTStop').disabled=true;
el('recBadge').classList.remove('on');
if(!S.voiceOn)stopVoiceMonitor();
toast('â¹ Recording stopped');
}

// TTS
el('btnTTSStart').addEventListener('click',()=>{
const text=el('scriptText').value.trim();
if(!text){toast('âš  Add some text first!');return;}
speechSynthesis.cancel();
const speak = () => {
    S.ttsUtt = new SpeechSynthesisUtterance(text);

    const voices = speechSynthesis.getVoices();
    const matchedVoice = voices.find(v => v.lang === S.lang);

    if (matchedVoice) {
        S.ttsUtt.voice = matchedVoice;
    }

    S.ttsUtt.lang = S.lang;

    S.ttsUtt.onend = () => {
        el('btnTTSStart').style.display='block';
        el('btnTTSStop').style.display='none';
    };

    speechSynthesis.speak(S.ttsUtt);

    el('btnTTSStart').style.display='none';
    el('btnTTSStop').style.display='block';

    toast('ğŸ”Š Reading...');
};

if(speechSynthesis.getVoices().length===0){speechSynthesis.onvoiceschanged=()=>{speak();};}
else{speak();}
});
el('btnTTSStop').addEventListener('click',()=>{
speechSynthesis.cancel();
el('btnTTSStart').style.display='block';el('btnTTSStop').style.display='none';
toast('â¸ Stopped');
});

// AI TOOLS
function genSummary(){
const txt=el('scriptText').value.trim();
if(!txt){toast('âš  Add a script first!');return;}
const sentences=txt.split(/[.!?]+/).filter(Boolean);
const summary=sentences.slice(0,Math.min(3,sentences.length)).join('. ')+'.';
el('summaryBox').textContent=summary;
el('summaryBox').style.display='block';
toast('ğŸ“„ Summary ready!');
}
function genKeywords(){
const txt=el('scriptText').value.trim().toLowerCase();
if(!txt){toast('âš  Add a script first!');return;}
const stop=['the','is','at','which','on','a','an','and','or','but','in','with','to','for','of','as','by','from','this','that','it','are','was','were','be','been','has','have','had','will','would','could','should','can','may','might'];
const words=txt.split(/\W+/).filter(w=>w.length>3&&!stop.includes(w));
const freq={};
words.forEach(w=>freq[w]=(freq[w]||0)+1);
const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,12);
el('kwWrap').innerHTML=sorted.map(([w])=>`<span class="kw-tag">${w}</span>`).join('');
el('keywordsCard').style.display='block';
toast('ğŸ”‘ Keywords extracted!');
}
function genActions(){
const txt=el('scriptText').value.trim();
if(!txt){toast('âš  Add a script first!');return;}
const sentences=txt.split(/[.!?]+/).filter(Boolean);
const triggers=['need','must','should','will','have to','got to','requires','complete','finish','send','follow up','schedule','update','review'];
const actions=sentences.filter(s=>triggers.some(t=>s.toLowerCase().includes(t))).slice(0,5);
if(actions.length===0){el('actionsWrap').innerHTML='<div style="color:#999;font-style:italic">No action items found</div>';}
else{el('actionsWrap').innerHTML=actions.map((a,i)=>`<div class="action-card"><strong>Action ${i+1}</strong>${a.trim()}</div>`).join('');}
el('actionsCard').style.display='block';
toast('ğŸ“‹ Action items identified!');
}
function genStats(){
const txt=el('scriptText').value.trim();
if(!txt){toast('âš  Add a script first!');return;}
const words=txt.split(/\s+/).filter(Boolean).length;
const sentences=txt.split(/[.!?]+/).filter(Boolean).length;
const chars=txt.length;
const readTime=Math.ceil(words/130);
const speakTime=Math.ceil(words/120);
const wps=sentences>0?Math.round(words/sentences):0;
el('statsGrid').innerHTML=`
<div class="stat-box"><div class="stat-num">${words}</div><div class="stat-lbl">Words</div></div>
<div class="stat-box"><div class="stat-num">${sentences}</div><div class="stat-lbl">Sentences</div></div>
<div class="stat-box"><div class="stat-num">${readTime} min</div><div class="stat-lbl">Read Time</div></div>
<div class="stat-box"><div class="stat-num">${speakTime} min</div><div class="stat-lbl">Speak Time</div></div>
<div class="stat-box"><div class="stat-num">${chars}</div><div class="stat-lbl">Characters</div></div>
<div class="stat-box"><div class="stat-num">${wps}</div><div class="stat-lbl">Words/Sentence</div></div>
`;
el('statsCard').style.display='block';
toast('ğŸ“Š Stats calculated!');
}

// EXPORT
function copyAll(){
const txt=el('scriptText').value.trim();
if(!txt){toast('âš  Nothing to copy!');return;}
navigator.clipboard.writeText(txt).then(()=>toast('âœ… Copied!')).catch(()=>toast('âš  Copy failed'));
}
function exportTxt(){
const txt=el('scriptText').value.trim();
if(!txt){toast('âš  Nothing to export!');return;}
const blob=new Blob([txt],{type:'text/plain'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;a.download='flowtalk-'+Date.now()+'.txt';
a.click();URL.revokeObjectURL(url);
toast('ğŸ“¥ File saved!');
}

// SCRIPTS
function saveScript(){
const txt=el('scriptText').value.trim();
const name=el('scriptName').value.trim();
if(!txt){toast('âš  Cannot save empty script');return;}
if(!name){toast('âš  Enter a script name');return;}
const scripts=JSON.parse(localStorage.getItem('ftScripts')||'[]');
scripts.unshift({name,text:txt,date:new Date().toISOString()});
localStorage.setItem('ftScripts',JSON.stringify(scripts));
el('scriptName').value='';
loadSavedScripts();
toast('ğŸ’¾ Script saved!');
}
function loadSavedScripts(){
const scripts=JSON.parse(localStorage.getItem('ftScripts')||'[]');
if(scripts.length===0){
el('savedList').style.display='none';
el('emptySaved').style.display='block';
return;
}
el('savedList').style.display='block';
el('emptySaved').style.display='none';
el('savedList').innerHTML=scripts.map((s,i)=>{
const d=new Date(s.date);
const date=d.toLocaleDateString()+' '+d.toLocaleTimeString();
return`<div class="saved-item" onclick="loadScript(${i})">
<div class="saved-item-info"><strong>${s.name}</strong><span>${date}</span></div>
<button class="del-btn" onclick="deleteScript(event,${i})">âœ•</button>
</div>`;
}).join('');
}
function loadScript(i){
const scripts=JSON.parse(localStorage.getItem('ftScripts')||'[]');
el('scriptText').value=scripts[i].text;
el('scriptName').value=scripts[i].name;
updateWC();
toast('ğŸ“‚ Script loaded!');
}
function deleteScript(e,i){
e.stopPropagation();
const scripts=JSON.parse(localStorage.getItem('ftScripts')||'[]');
scripts.splice(i,1);
localStorage.setItem('ftScripts',JSON.stringify(scripts));
loadSavedScripts();
toast('ğŸ—‘ Deleted');
}

// MEETING
el('btnStartMeeting').addEventListener('click',()=>{
const title=el('meetingTitle').value.trim();
if(!title){toast('âš  Enter meeting title');return;}
S.meetingStart=Date.now();
el('btnStartMeeting').disabled=true;
el('btnEndMeeting').disabled=false;
S.meetingTimer=setInterval(()=>{
const elapsed=Math.floor((Date.now()-S.meetingStart)/1000);
const m=Math.floor(elapsed/60);
const s=elapsed%60;
el('meetingTimer').textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
},1000);
startSTT();
toast('ğŸš€ Meeting recording started!');
});
el('btnEndMeeting').addEventListener('click',()=>{
if(S.meetingTimer){clearInterval(S.meetingTimer);S.meetingTimer=null;}
stopSTT();
const title=el('meetingTitle').value.trim();
const participants=el('meetingParticipants').value.trim();
const duration=el('meetingTimer').textContent;
const meetings=JSON.parse(localStorage.getItem('ftMeetings')||'[]');
meetings.unshift({
title,participants,duration,
transcript:S.transcript,
date:new Date().toISOString()
});
localStorage.setItem('ftMeetings',JSON.stringify(meetings));
el('meetingTitle').value='';
el('meetingParticipants').value='';
el('meetingTimer').textContent='00:00';
el('btnStartMeeting').disabled=false;
el('btnEndMeeting').disabled=true;
S.transcript='';
loadMeetings();
toast('âœ… Meeting saved!');
});
function loadMeetings(){
const meetings=JSON.parse(localStorage.getItem('ftMeetings')||'[]');
if(meetings.length===0){
el('meetingsList').style.display='none';
el('emptyMeetings').style.display='block';
return;
}
el('meetingsList').style.display='block';
el('emptyMeetings').style.display='none';
el('meetingsList').innerHTML=meetings.map((m,i)=>{
const d=new Date(m.date);
const date=d.toLocaleDateString();
return`<div class="saved-item" onclick="loadMeeting(${i})">
<div class="saved-item-info"><strong>${m.title}</strong><span>${date} â€¢ ${m.duration}</span></div>
<button class="del-btn" onclick="deleteMeeting(event,${i})">âœ•</button>
</div>`;
}).join('');
}
function loadMeeting(i){
const meetings=JSON.parse(localStorage.getItem('ftMeetings')||'[]');
el('scriptText').value=meetings[i].transcript;
updateWC();
toast('ğŸ“‚ Meeting loaded!');
}
function deleteMeeting(e,i){
e.stopPropagation();
const meetings=JSON.parse(localStorage.getItem('ftMeetings')||'[]');
meetings.splice(i,1);
localStorage.setItem('ftMeetings',JSON.stringify(meetings));
loadMeetings();
toast('ğŸ—‘ Deleted');
}
function exportMeeting(){
const meetings=JSON.parse(localStorage.getItem('ftMeetings')||'[]');
if(meetings.length===0){toast('âš  No meetings to export');return;}
const m=meetings[0];
const md=`# ${m.title}\n\n**Date:** ${new Date(m.date).toLocaleString()}\n**Duration:** ${m.duration}\n**Participants:** ${m.participants||'N/A'}\n\n## Transcript\n\n${m.transcript}\n`;
const blob=new Blob([md],{type:'text/markdown'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;a.download='meeting-'+Date.now()+'.md';
a.click();URL.revokeObjectURL(url);
toast('ğŸ“Š Report exported!');
}

// INIT

    loadSavedScripts();
    loadMeetings();
</script>
</body>
</html>